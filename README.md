# ğŸ¬ MyNameChat - AI è§†é¢‘/å›¾åƒè¿ç»­åˆ›ä½œåŠ©æ‰‹ (é‡æ„ç‰ˆ)

åŸºäº **LangGraph** æ„å»ºçš„æ¨¡å—åŒ–æ™ºèƒ½åˆ›ä½œåŠ©æ‰‹ï¼Œæ—¨åœ¨æä¾›**ä»»æ„ä¸»é¢˜ä¸‹çš„ AI è§†é¢‘/å›¾åƒåˆ›ä½œæµç¨‹è¾…åŠ©**ã€‚

æœ¬é¡¹ç›®ä»¥ã€Šä½ çš„åå­—ã€‹(å›ã®åã¯) ç»­é›†åˆ›ä½œä¸ºæ¼”ç¤ºæ¡ˆä¾‹ï¼ˆDemoï¼‰ï¼Œå®é™…ä¸Šé‡‡ç”¨ **èŠ‚ç‚¹å·¥å‚ (Node Factory)** ä¸ **å›¾æ„å»ºå™¨ (Graph Builder)** æ¶æ„ï¼Œæ”¯æŒé€šè¿‡é…ç½®å¿«é€Ÿæ„å»ºä¸åŒé£æ ¼çš„åˆ›ä½œ Agentã€‚

åœ¨ä¿æŒ**è¿ç»­ä¿®å›¾**ã€**è‡ªåŠ¨ä¸Šä¸‹æ–‡åŠ è½½**ä»¥åŠ**å¤šæ¨¡æ€ç”Ÿæˆ**ç­‰æ ¸å¿ƒèƒ½åŠ›çš„åŒæ—¶ï¼Œæ–°çš„æ¶æ„æå¤§åœ°æé«˜äº†ä»£ç çš„å¤ç”¨æ€§å’Œæ‰©å±•æ€§ã€‚

## âœ¨ æ ¸å¿ƒç‰¹æ€§

### ğŸ—ï¸ æ¶æ„å‡çº§
*   **Multi-Agent æ¶æ„**ï¼šé€šè¿‡å›¾ (Graph) ç¼–æ’ï¼Œçµæ´»ç»„åˆ LLMã€å·¥å…·å’ŒçŠ¶æ€ç®¡ç†ã€‚
*   **Factory æ¨¡å¼**ï¼šä½¿ç”¨å·¥å‚å‡½æ•°åŠ¨æ€ç”ŸæˆèŠ‚ç‚¹ï¼Œæ¶ˆé™¤é‡å¤ä»£ç ï¼Œè½»æ¾æ‰©å±•æ–° Agentã€‚
*   **æ¨¡å—åŒ–è®¾è®¡**ï¼šä¸šåŠ¡é€»è¾‘ï¼ˆNodesï¼‰ã€å·¥å…·ï¼ˆToolsï¼‰ã€æç¤ºè¯ï¼ˆPromptsï¼‰ä¸é…ç½®ï¼ˆAppsï¼‰å½»åº•åˆ†ç¦»ã€‚

### ğŸ§  æ™ºèƒ½çŠ¶æ€ç®¡ç†
*   **è‡ªåŠ¨åŠ è½½ (Auto-Load)**ï¼šæ— éœ€é‡å¤ä¸Šä¼ ï¼ŒAgent ä¼šè‡ªåŠ¨æ£€æµ‹å¹¶åŠ è½½ä¸Šä¸€è½®ç”Ÿæˆçš„å›¾ç‰‡ä½œä¸ºæ–°ä»»åŠ¡çš„å‚è€ƒç´ æã€‚
*   **è¿ç»­åˆ›ä½œ**ï¼šæ”¯æŒåŸºäºä¸Šä¸€è½®ç»“æœè¿›è¡Œ "Retry"ï¼ˆé‡ç»˜ï¼‰æˆ– "Edit"ï¼ˆä¿®å›¾ï¼‰ã€‚
*   **å…¨å±€é…ç½®**ï¼šæŒä¹…åŒ–é£æ ¼ã€åˆ†è¾¨ç‡é…ç½®ã€‚

### ğŸ¨ é«˜çº§ç”Ÿæˆå¼•æ“
*   **å›¾åƒå¼•æ“ (PPIO / Banana Pro)**ï¼šé›†æˆ PPIO Nano Banana Pro æ¨¡å‹ï¼Œæ”¯æŒé«˜è´¨é‡å›¾åƒç”Ÿæˆä¸å±€éƒ¨é‡ç»˜ã€‚é‡‡ç”¨å¼‚æ­¥ + æ•°æ®åº“ (Supabase) æ¶æ„è¿½è¸ªä»»åŠ¡ã€‚
*   **è§†é¢‘å¼•æ“ (KIE / Sora-2)**ï¼šæ”¯æŒ Text-to-Video å’Œ Image-to-Video (é¦–å¸§é©±åŠ¨)ã€‚

### ğŸ’¡ æ™ºèƒ½äº¤äº’
*   **å»ºè®®ç”Ÿæˆ**ï¼šå¯é€‰æŒ‚è½½â€œå»ºè®®ç”ŸæˆèŠ‚ç‚¹â€ï¼Œæ ¹æ®å¯¹è¯ä¸Šä¸‹æ–‡ä¸ºç”¨æˆ·æä¾›åç»­æ“ä½œæŒ‡å¼•ï¼ˆå¦‚ï¼šä¿®å›¾å»ºè®®ã€è½¬è§†é¢‘å»ºè®®ï¼‰ã€‚

## ğŸ“ å·¥ç¨‹æ¶æ„

```mermaid
graph TD
    subgraph "Entry Points (apps/)"
        A1[MyNameTemplate.py]
        A2[CustomTemplate.py]
        A3[MyNameTemplate_suggestion.py]
    end

    subgraph "Core Graph Logic (graphs/ & nodes/)"
        B1["builder.py <br/> (create_base_ReAct_graph)"]
        B2["nodes/core.py <br/> (LLM Call & Auto-Load)"]
        B3["nodes/common.py <br/> (Prep & Recorder)"]
        B4["nodes/routers.py <br/> (Conditional Edges)"]
        B5["nodes/suggestion.py <br/> (Suggestion Gen)"]
    end

    subgraph "State Management (state/)"
        C1["schemas.py <br/> (AgentState)"]
    end

    subgraph "Tools Library (tools/)"
        D1["registry.py <br/> (Tool Aggregator)"]
        D2["image.py <br/> (PPIO/Seedream)"]
        D3["video.py <br/> (Sora-2)"]
        D4["utils.py <br/> (Helpers & Config)"]
    end

    subgraph "Prompts & Utils (prompts/ & utils/)"
        E1["templates.py <br/> (System Prompts)"]
        E2["logger.py <br/> (Context-Aware Logger)"]
    end

    %% Relationships
    A1 & A2 & A3 -->|Calls| B1
    A1 & A2 & A3 -->|Configures| E2
    
    B1 -->|Assembles| B2
    B1 -->|Assembles| B3
    B1 -->|Assembles| B4
    B1 -.->|Optional| B5
    B1 -->|Uses| C1
    
    B2 -->|Uses| D1
    B2 -->|Uses| E1
    
    D1 -->|Imports| D2
    D1 -->|Imports| D3
    D2 & D3 -->|Uses| D4
    D4 -->|Logs via| E2
```

```text
MyNameChat/
â”œâ”€â”€ apps/                # [å…¥å£] åº”ç”¨é…ç½®å±‚ (Thin Wrappers)
â”‚   â”œâ”€â”€ MyNameTemplate.py             # [æ—§ç‰ˆ] æ ¼å¼åŒ–è¾“å‡º Demo (ç»Ÿä¸€è¾“å‡º Answer + Suggestions)
â”‚   â”œâ”€â”€ MyNameTemplate_suggestion.py  # [æ–°ç‰ˆ] æ¨èæ¶æ„ï¼šæµå¼è¾“å‡ºå¯¹è¯ + ç‹¬ç«‹èŠ‚ç‚¹ç”Ÿæˆå»ºè®® (é€‚é…å‰ç«¯æµå¼)
â”‚   â””â”€â”€ CustomTemplate.py             # [é€šç”¨] ç”¨æˆ·è‡ªå®šä¹‰åˆ›ä½œæ¨¡å— (æ”¯æŒä»»æ„ä¸»é¢˜é…ç½®)
â”œâ”€â”€ graphs/              # [æ ¸å¿ƒ] å›¾ç¼–æ’å±‚
â”‚   â””â”€â”€ builder.py                    # é€šç”¨ Graph æ„å»ºå·¥å‚
â”œâ”€â”€ nodes/               # [æ ¸å¿ƒ] èŠ‚ç‚¹é€»è¾‘å±‚
â”‚   â”œâ”€â”€ core.py                       # LLM è°ƒç”¨ä¸è‡ªåŠ¨å›æé€»è¾‘
â”‚   â”œâ”€â”€ common.py                     # é€šç”¨é¢„å¤„ç†ä¸è®°å½•å™¨
â”‚   â”œâ”€â”€ suggestion.py                 # å»ºè®®ç”ŸæˆèŠ‚ç‚¹
â”‚   â””â”€â”€ routers.py                    # è·¯ç”±æ§åˆ¶
â”œâ”€â”€ state/               # [æ ¸å¿ƒ] çŠ¶æ€å®šä¹‰
â”‚   â””â”€â”€ schemas.py                    # AgentState æ•°æ®ç»“æ„
â”œâ”€â”€ tools/               # [æ ¸å¿ƒ] å·¥å…·åº“
â”‚   â”œâ”€â”€ image.py                      # å›¾åƒç”Ÿæˆ/ç¼–è¾‘ (Seedream, Banana)
â”‚   â”œâ”€â”€ video.py                      # è§†é¢‘ç”Ÿæˆ (Sora)
â”‚   â”œâ”€â”€ general.py                    # é€šç”¨å·¥å…· (çŠ¶æ€æŸ¥è¯¢, å»æ°´å°)
â”‚   â””â”€â”€ registry.py                   # å·¥å…·æ³¨å†Œè¡¨
â”œâ”€â”€ prompts/             # [æ ¸å¿ƒ] æç¤ºè¯ç®¡ç†
â”‚   â””â”€â”€ templates.py                  # System Prompts å’Œå·¥å…·æè¿°
â”œâ”€â”€ utils/               # [è¾…åŠ©] é€šç”¨å·¥å…·
â”‚   â””â”€â”€ logger.py                     # æ—¥å¿—è®°å½•å™¨
â”œâ”€â”€ langgraph.json       # [é…ç½®] LangGraph æœåŠ¡é…ç½®æ–‡ä»¶
â””â”€â”€ .env                 # [é…ç½®] ç¯å¢ƒå˜é‡
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒå‡†å¤‡

ç¡®ä¿å·²å®‰è£… Python 3.11+ å’Œä¾èµ–åŒ…ï¼š

```bash
pip install -r requirements.txt
```

### 2. é…ç½®ç¯å¢ƒå˜é‡

åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º `.env` æ–‡ä»¶ï¼ˆå‚è€ƒä¹‹å‰çš„é…ç½®ï¼‰ï¼š

```env
# LLM
OPENAI_API_KEY=sk-your-key
DOUBAO_API_KEY=your-key # å¦‚æœä½¿ç”¨è±†åŒ…

# KIE Services
KIE_API_KEY=your-kie-key

# PPIO Services
GEMINI_API_KEY=your-ppio-key

# Supabase
VITE_SUPABASE_URL=your-url
VITE_SUPABASE_ANON_KEY=your-key
```

### 3. è¿è¡Œåº”ç”¨

#### LangGraph Server (æ¨è)
æœ¬é¡¹ç›®éµå¾ª LangGraph æ ‡å‡†ç»“æ„ï¼Œæ”¯æŒç›´æ¥å¯åŠ¨ API æœåŠ¡ï¼š

```bash
langgraph dev
```

## ğŸ”„ å·¥ä½œæµé€»è¾‘ (Refactored)

æ–°æ¶æ„ä¸‹çš„æ•°æ®æµè½¬æ›´åŠ æ¸…æ™°ï¼š

1.  **Initial Prep (`nodes/common.py`)**: è§£æè¾“å…¥ï¼Œåˆå§‹åŒ– Stateã€‚
2.  **Model Call (`nodes/core.py`)**: 
    *   **Auto-Load Logic**: æ£€æŸ¥ `model_call_count` å’Œ `last_task_id`ï¼Œå¿…è¦æ—¶è‡ªåŠ¨å›æä¸Šä¸€è½®ç»“æœå¹¶æ³¨å…¥ Promptã€‚
    *   **LLM Execution**: è°ƒç”¨ç»‘å®šäº†å·¥å…·çš„ LLMã€‚
3.  **Router (`nodes/routers.py`)**: åˆ¤æ–­ LLM æ˜¯å¦å‘èµ·äº†å·¥å…·è°ƒç”¨ã€‚
4.  **Tool Execution (`tools/`)**: æ‰§è¡Œå…·ä½“å·¥å…·ï¼ˆPPIO/KIEï¼‰ï¼Œè¿”å› `task_id`ã€‚
5.  **Recorder (`nodes/common.py`)**: æ•è·å·¥å…·è¾“å‡ºï¼Œæ›´æ–° `last_task_id` ç­‰çŠ¶æ€ï¼Œä¸ºä¸‹ä¸€è½® Auto-Load åšå‡†å¤‡ã€‚
6.  **Suggestion (Optional) (`nodes/suggestion.py`)**: å¦‚æœå¼€å¯äº†å»ºè®®åŠŸèƒ½ï¼Œåœ¨å¯¹è¯ç»“æŸå‰ç”Ÿæˆåç»­æŒ‡å¼•ã€‚

## ğŸ“ å¯ç”¨å·¥å…·

| å·¥å…·åç§° | åŠŸèƒ½æè¿° | å¯¹åº”æ–‡ä»¶ |
|---------|----------|----------|
| `image_edit_by_ppio_banana_pro_create_task` | **[ä¸»åŠ›]** å›¾åƒç”Ÿæˆ/ç¼–è¾‘ | `tools/image.py` |
| `text_to_video_by_kie_sora2_create_task` | æ–‡æœ¬ç”Ÿæˆè§†é¢‘ | `tools/video.py` |
| `first_frame_to_video_by_kie_sora2_create_task` | é¦–å¸§é©±åŠ¨è§†é¢‘ | `tools/video.py` |
| `remove_watermark_from_image_by_kie_seedream_v4_create_task` | å»é™¤æ°´å° | `tools/image.py` |
| `get_task_status` | ç»Ÿä¸€çŠ¶æ€æŸ¥è¯¢ | `tools/general.py` |

## ğŸ¤ è´¡çŒ®
æ¬¢è¿æäº¤ Pull Request æˆ– Issueã€‚

## ğŸ“„ è®¸å¯è¯
MIT License
